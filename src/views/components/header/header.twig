{#
| Variable         | Type    | Description                     |
|------------------|---------|---------------------------------|
| cart             | object  |                                 |
| cart.items_count | int     |                                 |
| cart.total       | string  | Formatted total ex: "١٠٠ ر.س"   |
#}

<header class="slimsh-style" style="border: 5px solid red !important;">
  {# Main Header - Single Row Like Slimsh #}
  <div class="main-header">
    <div class="container">
      <div class="header-wrapper">
        {# Left Section - Logo #}
        <div class="header-start">
          <a class="navbar-brand" href="{{ store.url }}">
            <img fetchpriority="high" width="auto" height="50" loading="eager" 
                 src="{{ store.logo }}" alt="{{ store.name }} logo">
            {% if is_page('index') %}
              <h1 class="sr-only">{{ store.name }}</h1>
            {% else %}
              <h2 class="sr-only">{{ store.name }}</h2>
            {% endif %}
          </a>
        </div>

        {# Center Section - Main Menu (Desktop Only) #}
        <nav class="header-center hidden lg:flex my-5">
          <ul class="main-menu-list">
            <li><a href="{{ link('/') }}" class="menu-link {{ is_page('index') ? 'active' : '' }}">الرئيسية</a></li>
            asdadasd
            {# Dynamic Categories #}
            {% for category in store.categories.roots().limit(6) %}
              <li class="has-dropdown">
                <a href="{{ category.url }}" class="menu-link">{{ category.name }}</a>
                {% if category.children|length > 0 %}
                  <div class="dropdown-menu">
                    <div class="dropdown-inner">
                      {% for subcategory in category.children %}
                        <a href="{{ subcategory.url }}" class="dropdown-item">{{ subcategory.name }}</a>
                      {% endfor %}
                    </div>
                  </div>
                {% endif %}
              </li>
            {% endfor %}
            
            <li><a href="{{ link('brands') }}" class="menu-link">الماركات</a></li>
            <li><a href="{{ link('offers') }}" class="menu-link text-red-500">العروض</a></li>
          </ul>
        </nav>

        {# Right Section - Actions #}
        <div class="header-end">
          {# Search Icon #}
          <button class="header-icon-btn" onclick="openSearchModal()" aria-label="Search">
            <i class="sicon-search"></i>
          </button>

          {# User Account #}
          {% if user.type == 'user' %}
            <salla-user-menu avatar-only show-header></salla-user-menu>
          {% else %}
            <button class="header-icon-btn" aria-label="Login" onclick="salla.event.dispatch('login::open')">
              <i class="sicon-user-circle"></i>
            </button>
          {% endif %}

          {# Cart with Badge #}
          <salla-cart-summary class="header-cart">
            <a slot="icon" href="{{ link('cart') }}" class="header-icon-btn relative">
              <i class="sicon-shopping-bag"></i>
              <span class="cart-badge" data-cart-count>{{ cart.items_count ?: 0 }}</span>
            </a>
          </salla-cart-summary>

          {# Mobile Menu Toggle #}
          <button class="header-icon-btn lg:hidden" onclick="openMobileMenu()" aria-label="Menu">
            <i class="sicon-menu"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  {# Search Modal #}
  <div id="search-modal" class="search-modal">
    <div class="search-modal-inner">
      <button class="close-search" onclick="closeSearchModal()">
        <i class="sicon-cancel"></i>
      </button>
      <div class="search-container">
        <salla-search inline autofocus></salla-search>
        
        {# Quick Search Filters #}
        <div class="quick-search-filters mt-6">
          <h3 class="text-lg font-bold mb-4">البحث السريع</h3>
          <div class="filter-tags">
            {% for category in store.categories.roots().limit(8) %}
              <a href="{{ category.url }}" class="filter-tag">{{ category.name }}</a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  {# Mobile Menu Overlay #}
  <div id="mobile-menu-overlay" class="mobile-menu-overlay">
    <div class="mobile-menu">
      <div class="mobile-menu-header">
        <h2 class="text-xl font-bold">القائمة الرئيسية</h2>
        <button class="close-menu" onclick="closeMobileMenu()">
          <i class="sicon-cancel"></i>
        </button>
      </div>
      <nav class="mobile-menu-nav">
        <a href="{{ link('/') }}" class="mobile-menu-item {{ is_page('index') ? 'active' : '' }}">
          <i class="sicon-home ml-3"></i> الرئيسية
        </a>
        
        {# Categories with subcategories #}
        {% for category in store.categories.roots() %}
          <div class="mobile-menu-category">
            <a href="{{ category.url }}" class="mobile-menu-item">
              <i class="sicon-category ml-3"></i> {{ category.name }}
            </a>
            {% if category.children|length > 0 %}
              <div class="mobile-submenu">
                {% for subcategory in category.children %}
                  <a href="{{ subcategory.url }}" class="mobile-submenu-item">{{ subcategory.name }}</a>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        {% endfor %}
        
        <a href="{{ link('brands') }}" class="mobile-menu-item">
          <i class="sicon-award-ribbon ml-3"></i> الماركات
        </a>
        <a href="{{ link('offers') }}" class="mobile-menu-item text-red-500">
          <i class="sicon-sale ml-3"></i> العروض
        </a>
        
        {% if user.type == 'guest' %}
          <a href="#" onclick="salla.event.dispatch('login::open')" class="mobile-menu-item">
            <i class="sicon-user ml-3"></i> تسجيل الدخول
          </a>
        {% endif %}
      </nav>
    </div>
  </div>
</header>

<script>
  function openSearchModal() {
    document.getElementById('search-modal').classList.add('active');
    document.body.classList.add('modal-open');
    setTimeout(() => {
      document.querySelector('#search-modal input')?.focus();
    }, 300);
  }

  function closeSearchModal() {
    document.getElementById('search-modal').classList.remove('active');
    document.body.classList.remove('modal-open');
  }

  function openMobileMenu() {
    document.getElementById('mobile-menu-overlay').classList.add('active');
    document.body.classList.add('modal-open');
  }

  function closeMobileMenu() {
    document.getElementById('mobile-menu-overlay').classList.remove('active');
    document.body.classList.remove('modal-open');
  }

  // Close modals on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeSearchModal();
      closeMobileMenu();
    }
  });
</script>

{% if store.scope %}
  <salla-scopes selection="{{ store.scope.display_as == 'popup' ? 'mandatory' : 'optional' }}"></salla-scopes>
{% endif %}