{% extends "layouts.master" %}

{% block content %}
<div class="container">
    <nav class="breadcrumb mb-6">
        <a href="{{ link('/') }}">الرئيسية</a>
        <i class="sicon-keyboard_arrow_left mx-2"></i>
        <span>{{ category.name }}</span>
    </nav>

    <div class="grid grid-cols-12 gap-6">
        {# Filters Sidebar #}
        <aside class="col-span-12 lg:col-span-3">
            <div class="filters-container bg-white rounded-lg shadow-sm p-4 sticky top-20">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-bold text-lg">تصفية النتائج</h3>
                    <button class="text-sm text-red-500 clear-filters hidden">مسح الكل</button>
                </div>

                {# Brand Filter will be inserted here by JS #}
                
                {# Price Range Filter #}
                <div class="filter-group mb-6">
                    <h4 class="font-semibold mb-3">السعر</h4>
                    <div class="price-range-inputs">
                        <div class="flex gap-2 mb-3">
                            <input type="number" 
                                   placeholder="من" 
                                   class="price-from form-input flex-1" 
                                   min="0">
                            <input type="number" 
                                   placeholder="إلى" 
                                   class="price-to form-input flex-1" 
                                   min="0">
                        </div>
                        <button class="apply-price-filter btn btn-primary btn-sm w-full">
                            تطبيق
                        </button>
                    </div>
                </div>

                {# Rating Filter #}
                {% if store.settings.rating_enabled %}
                <div class="filter-group mb-6">
                    <h4 class="font-semibold mb-3">التقييم</h4>
                    <div class="space-y-2">
                        {% for rating in [5, 4, 3, 2, 1] %}
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" 
                                       class="rating-filter ml-2" 
                                       value="{{ rating }}">
                                <div class="flex items-center">
                                    {% for i in 1..5 %}
                                        <i class="sicon-star {{ i <= rating ? 'text-yellow-400' : 'text-gray-300' }}"></i>
                                    {% endfor %}
                                    <span class="mr-2 text-sm text-gray-600">فما فوق</span>
                                </div>
                            </label>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {# Availability Filter #}
                <div class="filter-group">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" class="in-stock-only ml-2">
                        <span>المتوفر فقط</span>
                    </label>
                </div>
            </div>
        </aside>

        {# Products Grid #}
        <main class="col-span-12 lg:col-span-9">
            {# Sorting and View Options #}
            <div class="products-header bg-white rounded-lg shadow-sm p-4 mb-6">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="products-count">
                        عرض <span class="font-bold">{{ products.total }}</span> منتج
                    </div>
                    
                    <div class="flex items-center gap-4">
                        {# Sort Dropdown #}
                        <select class="form-select sort-products">
                            <option value="">ترتيب حسب</option>
                            <option value="new">الأحدث</option>
                            <option value="price-asc">السعر: من الأقل للأعلى</option>
                            <option value="price-desc">السعر: من الأعلى للأقل</option>
                            <option value="rating">الأعلى تقييماً</option>
                        </select>

                        {# Grid/List View Toggle #}
                        <div class="view-toggle flex">
                            <button class="view-grid active p-2">
                                <i class="sicon-grid text-lg"></i>
                            </button>
                            <button class="view-list p-2">
                                <i class="sicon-list text-lg"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            {# Products List #}
            <div class="s-products-list grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                {% for product in products %}
                    <div class="s-products-list-item" 
                         data-product-brand="{{ product.brand.name }}"
                         data-product-price="{{ product.price }}"
                         data-product-rating="{{ product.rating }}">
                        <salla-product-card 
                            class="product-entry" 
                            product="{{ product|json_encode }}">
                        </salla-product-card>
                    </div>
                {% endfor %}
            </div>

            {# Pagination #}
            {% if products.has_pages %}
                <div class="pagination-wrapper mt-8">
                    {{ products.links }}
                </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <script defer src="{{ 'brand-filter.js' | asset }}"></script>
    <script defer src="{{ 'category-filters.js' | asset }}"></script>
{% endblock %}